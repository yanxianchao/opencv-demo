// ================================================
// VS Code Dev Containers 配置文件
// 作用：定义开发容器环境，提供一致的开发体验
// ================================================
{
    // 容器环境名称，在VS Code状态栏中显示
    "name": "OpenCV C++ Development",
    
    // 构建配置
    "build": {
        // Dockerfile路径，相对于.devcontainer目录
        "dockerfile": "../Dockerfile",
        // 构建上下文路径，相对于.devcontainer目录
        "context": ".."
    },
    
    // 自定义配置
    "customizations": {
        // VS Code特定配置
        "vscode": {
            // 容器中预安装的VS Code扩展
            "extensions": [
                "ms-vscode.cpptools",                    // C/C++语言支持
                "ms-vscode.cpptools-extension-pack",     // C/C++扩展包
                "ms-vscode.cmake-tools",                 // CMake工具支持
                "twxs.cmake",                            // CMake语法高亮
                "ms-vscode.hexeditor",                   // 十六进制编辑器
                "ms-vscode.vscode-json",                 // JSON工具
                "jeff-hykin.better-cpp-syntax",          // 更好的C++语法高亮
                "james-yu.latex-workshop",               // LaTeX支持
                "cschlosser.doxdocgen",                  // Doxygen文档生成
                "aaron-bond.better-comments",            // 更好的注释高亮
                "ms-vscode.hexeditor"                    // 十六进制编辑器
            ],
            
            // 容器中的VS Code设置
            "settings": {
                // C/C++扩展默认配置提供者
                "C_Cpp.default.configurationProvider": "ms-vscode.cmake-tools",
                
                // C/C++ IntelliSense模式
                "C_Cpp.default.intelliSenseMode": "linux-gcc-x64",
                
                // Clang格式化样式
                "C_Cpp.clang_format_style": "{ BasedOnStyle: Google, IndentWidth: 4, ColumnLimit: 100 }",
                
                // CMake构建目录
                "cmake.buildDirectory": "${workspaceFolder}/build",
                
                // 打开工作区时自动配置CMake
                "cmake.configureOnOpen": true,
                
                // CMake生成器
                "cmake.generator": "Unix Makefiles",
                
                // CMake路径
                "cmake.cmakePath": "/usr/bin/cmake",
                
                // CMake配置参数
                "cmake.configureArgs": [
                    "-DCMAKE_BUILD_TYPE=Debug"
                ],
                
                // 文件关联配置
                "files.associations": {
                    "*.hpp": "cpp",
                    "*.cpp": "cpp"
                },
                
                // 保存时自动格式化
                "editor.formatOnSave": true,
                
                // 编辑器Tab大小
                "editor.tabSize": 4,
                
                // 使用空格代替Tab
                "editor.insertSpaces": true,
                
                // 终端工作目录
                "terminal.integrated.cwd": "${workspaceFolder}",
                
                // Linux终端配置
                "terminal.integrated.profiles.linux": {
                    "bash": {
                        "path": "bash"
                    }
                },
                
                // 默认终端为bash
                "terminal.integrated.defaultProfile.linux": "bash"
            }
        }
    },
    
    // 端口转发配置（用于Web服务等）
    "forwardPorts": [],
    
    // 容器创建后执行的命令
    "postCreateCommand": "# 动态设置正确的用户权限\n# 确保OpenCV环境变量正确设置\necho 'export PKG_CONFIG_PATH=/usr/lib/aarch64-linux-gnu/pkgconfig:$PKG_CONFIG_PATH' >> /home/developer/.bashrc\nUSER_ID=$(id -u developer)\nsudo chown -R developer:developer /workspace\necho \"OpenCV C++ Development Environment Ready! User ID: $USER_ID\"\necho \"OpenCV环境已配置完成\"",
    
    // 容器中使用的远程用户
    "remoteUser": "developer",
    
    // 容器中的工作目录
    "workspaceFolder": "/workspace",
    
    // 挂载配置
    "mounts": [
        // 绑定挂载：将本地工作区挂载到容器中的/workspace目录
        "source=${localWorkspaceFolder},target=/workspace,type=bind,consistency=cached"
    ],
    
    // Docker运行参数
    "runArgs": [
        // 添加系统调用跟踪能力（用于调试）
        "--cap-add=SYS_PTRACE",
        // 安全选项
        "--security-opt",
        // 禁用seccomp安全配置文件
        "seccomp=unconfined"
    ],
    
    // 容器特性配置
    "features": {
        // Git功能
        "ghcr.io/devcontainers/features/git:1": {},
        // GitHub CLI功能
        "ghcr.io/devcontainers/features/github-cli:1": {}
    }
}