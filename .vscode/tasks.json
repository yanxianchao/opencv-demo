// ================================================
// VS Code 任务配置文件
// 作用：定义可在VS Code中运行的自动化任务，如编译、构建、测试等
// ================================================
{
    // 任务配置文件版本号
    "version": "2.0.0",
    // 任务数组，定义所有可用的任务
    "tasks": [
        {
            // 任务标签名称，在任务列表中显示
            "label": "CMake Configure",
            // 任务类型：shell表示在shell中执行命令
            "type": "shell",
            // 要执行的命令
            "command": "cmake",
            // 命令参数数组
            "args": [
                "-S", // 指定源码目录
                ".", // 当前目录
                "-B", // 指定构建目录
                "build", // 构建目录名
                "-DCMAKE_BUILD_TYPE=Debug" // 设置构建类型为Debug
            ],
            // 任务组，用于分类任务
            "group": "build",
            // 任务执行时的显示设置
            "presentation": {
                "echo": true, // 在终端中显示执行的命令
                "reveal": "always", // 总是显示终端面板
                "focus": false, // 不聚焦到终端面板
                "panel": "shared" // 使用共享终端面板
            },
            // 问题匹配器，用于解析编译错误和警告
            "problemMatcher": []
        },
        {
            // CMake构建任务
            "label": "CMake Build",
            "type": "shell",
            "command": "cmake",
            "args": [
                "--build", // 构建命令
                "build", // 构建目录
                "--config", // 配置类型
                "Debug", // Debug配置
                "--parallel", // 并行构建
                "4" // 使用4个线程
            ],
            // 任务组配置
            "group": {
                "kind": "build", // 构建类型任务
                "isDefault": false // 不是默认构建任务
            },
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared"
            },
            // 问题匹配器，使用GCC格式解析错误
            "problemMatcher": [
                "$gcc"
            ],
            // 依赖任务，在执行此任务前先执行依赖任务
            "dependsOn": "CMake Configure"
        },
        {
            // 清理构建目录任务
            "label": "CMake Clean",
            "type": "shell",
            "command": "rm",
            "args": [
                "-rf", // 递归强制删除
                "build" // 删除build目录
            ],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared"
            },
            "problemMatcher": []
        },
        {
            // 运行OpenCV演示程序任务
            "label": "Run OpenCV Demo",
            "type": "shell",
            "command": "${workspaceFolder}/build/bin/opencv_demo",
            "group": "test",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": true, // 聚焦到终端面板
                "panel": "new" // 创建新终端面板
            },
            "problemMatcher": [],
            // 依赖任务，先执行CMake Build
            "dependsOn": "CMake Build"
        },
        {
            // 构建并运行任务（组合任务）
            "label": "Build and Run",
            // 依赖任务执行顺序
            "dependsOrder": "sequence",
            // 依赖多个任务
            "dependsOn": [
                "CMake Build",
                "Run OpenCV Demo"
            ],
            "group": {
                "kind": "test", // 测试类型任务
                "isDefault": true // 默认测试任务
            }
        },
        {
            // C++单文件编译任务（由调试器生成）
            "type": "cppbuild",
            "label": "C/C++: g++ build active file with OpenCV",
            "command": "/usr/bin/g++",
            "args": [
                "-fdiagnostics-color=always", // 彩色诊断信息
                "-g", // 生成调试信息
                "${file}", // 当前活动文件
                "-o", // 输出文件
                "${fileDirname}/${fileBasenameNoExtension}", // 输出到同名可执行文件
                "-I/usr/include/opencv4", // OpenCV头文件路径
                "-lopencv_core", // OpenCV核心库
                "-lopencv_imgproc", // 图像处理库
                "-lopencv_highgui", // 高级GUI库
                "-lopencv_imgcodecs", // 图像编解码库
                "-lopencv_videoio", // 视频IO库
                "-lopencv_objdetect", // 对象检测库
                "-lopencv_features2d", // 2D特征检测库
                "-lopencv_calib3d" // 3D校准库
            ],
            // 执行选项
            "options": {
                "cwd": "${fileDirname}" // 工作目录为当前文件所在目录
            },
            // 问题匹配器
            "problemMatcher": [
                "$gcc"
            ],
            // 任务组配置
            "group": {
                "kind": "build",
                "isDefault": true // 默认构建任务
            },
            // 任务详细描述
            "detail": "Task generated by Debugger with OpenCV support."
        }
    ]
}
